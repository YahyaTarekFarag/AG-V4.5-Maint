# تهيئة وتحديث قاعدة البيانات (Database Migrations)

هذا المجلد يحتوي على ملفات التحديث الخاصة بقاعدة بيانات المشروع على منصة Supabase.
تم ترقيم الملفات بصيغة `VXX__description.sql` لضمان تسلسل تنفيذها بدقة ولتسهيل تتبع التغييرات.

## الهيكلة الحالية:
* **`V01 - V04`**: إنشاء الجداول الأساسية (Profiles, Areas, Maintenance Categories, Tickets, Inventory...).
* **`V05 - V10`**: الدوال (Functions) والـ (Triggers) الأساسية.
* **`V11 - V17`**: تحسين وتعديل الـ Schema، وحل تعارضات سياسات الوصول (RLS).
* **`V18 - V25`**: دوال التقارير (RPCs) والإحصائيات، فهارس الأداء (Indexes)، والمناظر المؤقتة (Materialized Views).
* **`seed.sql`**: ملف مخصص لإدراج البيانات الأساسية الافتراضية (تصنيفات مقترحة، ومناطق ديمو) بعد استكمال بناء الهيكل.

## طريقة التنفيذ اليدوية في Supabase:
1. انتقل إلى لوحة تحكم `Supabase` > `SQL Editor`
2. افتح ملف `New Query`.
3. انسخ محتويات الملفات **بالترتيب التسلسلي** (من V01 وحتى V25).
4. أخيرًا، قم بتشغيل `seed.sql` لإعداد بيانات النظام الأولى.

## في حالة استخدام Supabase CLI:
يتم وضع هذه الملفات بطبيعتها ضمن توافقية نظام التحديث المحلي لـ Supabase بحيث يمكن تنفيذ:
```bash
supabase db push
```

**تحذير هام:** أي تعديل جديد أو إضافة لجدول يجب أن يكون في ملف جديد (مثلا `V26__new_feature.sql`)، ويُمنع تفريغ (Drop Structure) إلا للـ Functions والـ Views لعدم ضياع البيانات.
